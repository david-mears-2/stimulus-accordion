{"version":3,"file":"index.umd.js","sources":["../src/store.js","../src/index.js"],"sourcesContent":["export default class Store {\n  constructor(controller) {\n    this.controller = controller;\n  }\n\n  get togglers() {\n    return this.controller.togglers;\n  }\n\n  get openedTogglers() {\n    return this.controller.openedTogglers;\n  }\n\n  get key() {\n    return this.controller.storeKeyValue;\n  }\n\n  load() {\n    let ids = this.constructor.load(this.key);\n    if (!ids) return;\n\n    let idSet = new Set(ids);\n    this.togglers.forEach(toggler => {\n      let content = this.controller.findContent(toggler);\n      if (idSet.has(this.controller.getID(toggler))) {\n        this.controller.show(toggler, content)\n      } else {\n        this.controller.hide(toggler, content);\n      }\n    });\n  }\n\n  save() {\n    let ids = this.openedTogglers.map(toggler => this.controller.getID(toggler));\n    this.constructor.save(this.key, ids);\n  }\n\n  static load(key) {\n    if (!key) return;\n    let json = sessionStorage.getItem(key);\n    try {\n      return JSON.parse(json)\n    } catch {\n      return null;\n    }\n  }\n\n  static save(key, value) {\n    if (!key) return;\n    sessionStorage.setItem(key, JSON.stringify(value));\n  }\n}\n","import { Controller } from '@hotwired/stimulus';\nimport Store from './store';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    storeKey: String\n  };\n\n  get togglers() {\n    return this.context.bindingObserver.bindings\n               .filter(binding => binding.action.methodName == 'toggle')\n               .map(binding => binding.action.element);\n  }\n\n  get openedTogglers() {\n    return this.togglers.filter(toggler => this.isOpened(toggler));\n  }\n\n  get contents() {\n    return this.scope.findAllElements('[data-accordion-id]')\n  }\n\n  connect() {\n    this.enableTrans(false);\n\n    this.init();\n    this.store = new Store(this);\n    this.store.load();\n\n    setTimeout(() => this.enableTrans(true), 200);\n  }\n\n  enableTrans(enabled) {\n    this.contents.forEach(content => {\n      if (enabled) {\n        content.classList.remove('st-accordion--disable-trans');\n      } else {\n        content.classList.add('st-accordion--disable-trans');\n      }\n    });\n  }\n\n  init() {\n    this.togglers.forEach(toggler => {\n      let content = this.findContent(toggler);\n      if (this.isOpened(toggler)) {\n        this.show(toggler, content);\n      } else {\n        this.hide(toggler, content);\n      }\n    })\n  }\n\n  toggle(e) {\n    this.togglers.forEach(toggler => {\n      if (toggler == e.target) {\n        if (this.isOpened(toggler)) {\n          this.close(toggler);\n        } else {\n          this.open(toggler);\n        }\n      } else if (this.isOpened(toggler)) {\n        this.close(toggler);\n      }\n    });\n\n    e.preventDefault();\n  }\n\n  open(toggler) {\n    let content = this.findContent(toggler);\n    this.show(toggler, content);\n    this.store.save();\n    this.dispatch('opened', { detail: { toggler: toggler, content: content } });\n  }\n\n  close(toggler) {\n    let content = this.findContent(toggler);\n    this.hide(toggler, content);\n    this.store.save();\n    this.dispatch('closed', { detail: { toggler: toggler, content: content } });\n  }\n\n  show(toggler, content) {\n    this.toggleClass(toggler, content, true);\n  }\n\n  hide(toggler, content) {\n    this.toggleClass(toggler, content, false);\n  }\n\n  isOpened(toggler) {\n    return toggler.matches('.st-accordion__icon--opened');\n  }\n\n  toggleClass(toggler, content, opened) {\n    if (opened) {\n      toggler.classList.add('st-accordion__icon--opened');\n      content.classList.add('st-accordion__content--visible');\n      content.style.height = content.scrollHeight + 'px';\n    } else {\n      toggler.classList.remove('st-accordion__icon--opened');\n      content.classList.remove('st-accordion__content--visible');\n      content.style.height = '0px';\n    }\n\n    if (opened) {\n      let openedText = toggler.getAttribute('data-accordion-opened-text-param');\n      if (openedText) toggler.innerHTML = openedText;\n    } else {\n      let closedText = toggler.getAttribute('data-accordion-closed-text-param');\n      if (closedText) toggler.innerHTML = closedText;\n    }\n  }\n\n  findContent(toggler) {\n    let id = this.getID(toggler);\n    return this.scope.findElement(`[data-accordion-id=\"${id}\"]`);\n  }\n\n  getID(toggler) {\n    return  toggler.getAttribute('href').replace(/^#/, '');\n  }\n}\n"],"names":["Store","constructor","controller","this","togglers","openedTogglers","key","storeKeyValue","load","ids","idSet","Set","forEach","toggler","content","findContent","has","getID","show","hide","save","map","static","json","sessionStorage","getItem","JSON","parse","value","setItem","stringify","Controller","context","bindingObserver","bindings","filter","binding","action","methodName","element","isOpened","contents","scope","findAllElements","connect","enableTrans","init","store","setTimeout","enabled","classList","remove","add","toggle","e","target","close","open","preventDefault","dispatch","detail","toggleClass","matches","opened","style","height","scrollHeight","openedText","getAttribute","innerHTML","closedText","id","findElement","replace","values","storeKey","String"],"mappings":"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"}