{"version":3,"file":"index.modern.js","sources":["../src/store.js","../src/index.js"],"sourcesContent":["export default class Store {\n  constructor(controller) {\n    this.controller = controller;\n  }\n\n  get togglers() {\n    return this.controller.togglers;\n  }\n\n  get openedTogglers() {\n    return this.controller.openedTogglers;\n  }\n\n  get key() {\n    return this.controller.storeKeyValue;\n  }\n\n  load() {\n    if (!this.key) return;\n\n    let ids = this.constructor.load(this.key);\n    if (!ids) return;\n\n    let idSet = new Set(ids);\n    this.togglers.forEach(toggler => {\n      let content = this.controller.findContent(toggler);\n      if (idSet.has(this.controller.getID(toggler))) {\n        this.controller.show(toggler, content)\n      } else {\n        this.controller.hide(toggler, content);\n      }\n    });\n  }\n\n  save() {\n    if (!this.key) return;\n\n    let ids = this.openedTogglers.map(toggler => this.controller.getID(toggler));\n    this.constructor.save(this.key, ids);\n  }\n\n  static load(key) {\n    let json = sessionStorage.getItem(key);\n    try {\n      return JSON.parse(json)\n    } catch(error) {\n      console.error(error);\n      return null;\n    }\n  }\n\n  static save(key, value) {\n    try {\n      sessionStorage.setItem(key, JSON.stringify(value));\n    } catch(error) {\n      console.error(error);\n      return null;\n    }\n  }\n}\n","import { Controller } from '@hotwired/stimulus';\nimport Store from './store';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    storeKey: String\n  };\n\n  get togglers() {\n    return this.context.bindingObserver.bindings\n               .filter(binding => binding.action.methodName == 'toggle')\n               .map(binding => binding.action.element);\n  }\n\n  get openedTogglers() {\n    return this.togglers.filter(toggler => this.isOpened(toggler));\n  }\n\n  get contents() {\n    return this.scope.findAllElements('[data-accordion-id]')\n  }\n\n  connect() {\n    this.init();\n    this.store = new Store(this);\n    this.store.load();\n  }\n\n  init() {\n    this.togglers.forEach(toggler => {\n      let content = this.findContent(toggler);\n      if (this.isOpened(toggler)) {\n        this.show(toggler, content, false);\n      } else {\n        this.hide(toggler, content, false);\n      }\n    })\n  }\n\n  toggle(e) {\n    this.togglers.forEach(toggler => {\n      if (toggler.contains(e.target)) {\n        if (this.isOpened(toggler)) {\n          this.close(toggler);\n        } else {\n          this.open(toggler);\n        }\n      } else if (this.isOpened(toggler)) {\n        this.close(toggler);\n      }\n    });\n\n    e.preventDefault();\n  }\n\n  open(toggler) {\n    let content = this.findContent(toggler);\n    this.show(toggler, content);\n    this.store.save();\n    this.dispatch('opened', { detail: { toggler: toggler, content: content } });\n  }\n\n  close(toggler) {\n    let content = this.findContent(toggler);\n    this.hide(toggler, content);\n    this.store.save();\n    this.dispatch('closed', { detail: { toggler: toggler, content: content } });\n  }\n\n  show(toggler, content, transition = true) {\n    if (transition) {\n      content.style.height = '0px';\n      content.removeEventListener('transitionend', this.transitionEnd);\n      content.addEventListener('transitionend', this.transitionEnd);\n      setTimeout(() => {\n        content.style.height = content.scrollHeight + 'px';\n      });\n    }\n\n    this.toggleClass(toggler, content, true);\n    this.toggleText(toggler, true);\n  }\n\n  hide(toggler, content, transition = true) {\n    if (transition) {\n      content.style.height = content.scrollHeight + 'px';\n      content.removeEventListener('transitionend', this.transitionEnd);\n      content.addEventListener('transitionend', this.transitionEnd);\n      setTimeout(() => {\n        content.style.height = '0px';\n      });\n    }\n\n    this.toggleClass(toggler, content, false);\n    this.toggleText(toggler, false);\n  }\n\n  transitionEnd(e) {\n    e.target.style.height = '';\n  }\n\n  toggleClass(toggler, content, opened) {\n    if (opened) {\n      toggler.classList.add('st-accordion__icon--opened');\n      content.classList.add('st-accordion__content--visible');\n    } else {\n      toggler.classList.remove('st-accordion__icon--opened');\n      content.classList.remove('st-accordion__content--visible');\n    }\n  }\n\n  toggleText(toggler, opened) {\n    let text;\n    if (opened) {\n      text = toggler.getAttribute('data-accordion-opened-text-param');\n    } else {\n      text = toggler.getAttribute('data-accordion-closed-text-param');\n    }\n    if (text) toggler.innerHTML = text;\n  }\n\n  isOpened(toggler) {\n    return toggler.matches('.st-accordion__icon--opened');\n  }\n\n  findContent(toggler) {\n    let id = this.getID(toggler);\n    return this.scope.findElement(`[data-accordion-id=\"${id}\"]`);\n  }\n\n  getID(toggler) {\n    return toggler.getAttribute('href').replace(/^#/, '');\n  }\n}\n"],"names":["Store","constructor","controller","this","togglers","openedTogglers","key","storeKeyValue","load","ids","idSet","Set","forEach","toggler","content","findContent","has","getID","show","hide","save","map","static","json","sessionStorage","getItem","JSON","parse","error","console","value","setItem","stringify","Controller","context","bindingObserver","bindings","filter","binding","action","methodName","element","isOpened","contents","scope","findAllElements","connect","init","store","toggle","e","contains","target","close","open","preventDefault","dispatch","detail","transition","style","height","removeEventListener","transitionEnd","addEventListener","setTimeout","scrollHeight","toggleClass","toggleText","opened","classList","add","remove","text","getAttribute","innerHTML","matches","id","findElement","replace","values","storeKey","String"],"mappings":"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"}