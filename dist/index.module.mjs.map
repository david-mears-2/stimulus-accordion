{"version":3,"file":"index.module.mjs","sources":["../src/store.js","../src/index.js"],"sourcesContent":["export default class Store {\n  constructor(controller) {\n    this.controller = controller;\n  }\n\n  get togglers() {\n    return this.controller.togglers;\n  }\n\n  get openedTogglers() {\n    return this.controller.openedTogglers;\n  }\n\n  get key() {\n    return this.controller.storeKeyValue;\n  }\n\n  load() {\n    if (!this.key) return;\n\n    let ids = this.constructor.load(this.key);\n    if (!ids) return;\n\n    let idSet = new Set(ids);\n    this.togglers.forEach(toggler => {\n      let content = this.controller.findContent(toggler);\n      if (idSet.has(this.controller.getID(toggler))) {\n        this.controller.show(toggler, content)\n      } else {\n        this.controller.hide(toggler, content);\n      }\n    });\n  }\n\n  save() {\n    if (!this.key) return;\n\n    let ids = this.openedTogglers.map(toggler => this.controller.getID(toggler));\n    this.constructor.save(this.key, ids);\n  }\n\n  static load(key) {\n    let json = sessionStorage.getItem(key);\n    try {\n      return JSON.parse(json)\n    } catch(error) {\n      console.error(error);\n      return null;\n    }\n  }\n\n  static save(key, value) {\n    try {\n      sessionStorage.setItem(key, JSON.stringify(value));\n    } catch(error) {\n      console.error(error);\n      return null;\n    }\n  }\n}\n","import { Controller } from '@hotwired/stimulus';\nimport Store from './store';\nimport './index.scss';\n\nexport default class extends Controller {\n  static values = {\n    storeKey: String\n  };\n\n  get togglers() {\n    return this.context.bindingObserver.bindings\n               .filter(binding => binding.action.methodName == 'toggle')\n               .map(binding => binding.action.element);\n  }\n\n  get openedTogglers() {\n    return this.togglers.filter(toggler => this.isOpened(toggler));\n  }\n\n  get contents() {\n    return this.scope.findAllElements('[data-accordion-id]')\n  }\n\n  connect() {\n    this.init();\n    this.store = new Store(this);\n    this.store.load();\n  }\n\n  init() {\n    this.togglers.forEach(toggler => {\n      let content = this.findContent(toggler);\n      if (this.isOpened(toggler)) {\n        this.show(toggler, content, false);\n      } else {\n        this.hide(toggler, content, false);\n      }\n    })\n  }\n\n  toggle(e) {\n    this.togglers.forEach(toggler => {\n      if (toggler.contains(e.target)) {\n        if (this.isOpened(toggler)) {\n          this.close(toggler);\n        } else {\n          this.open(toggler);\n        }\n      } else if (this.isOpened(toggler)) {\n        this.close(toggler);\n      }\n    });\n\n    e.preventDefault();\n  }\n\n  open(toggler) {\n    let content = this.findContent(toggler);\n    this.show(toggler, content);\n    this.store.save();\n    this.dispatch('opened', { detail: { toggler: toggler, content: content } });\n  }\n\n  close(toggler) {\n    let content = this.findContent(toggler);\n    this.hide(toggler, content);\n    this.store.save();\n    this.dispatch('closed', { detail: { toggler: toggler, content: content } });\n  }\n\n  show(toggler, content, transition = true) {\n    if (transition) {\n      content.style.height = '0px';\n      content.removeEventListener('transitionend', this.transitionEnd);\n      content.addEventListener('transitionend', this.transitionEnd);\n      setTimeout(() => {\n        content.style.height = content.scrollHeight + 'px';\n      });\n    }\n\n    this.toggleClass(toggler, content, true);\n    this.toggleText(toggler, true);\n  }\n\n  hide(toggler, content, transition = true) {\n    if (transition) {\n      content.style.height = content.scrollHeight + 'px';\n      content.removeEventListener('transitionend', this.transitionEnd);\n      content.addEventListener('transitionend', this.transitionEnd);\n      setTimeout(() => {\n        content.style.height = '0px';\n      });\n    }\n\n    this.toggleClass(toggler, content, false);\n    this.toggleText(toggler, false);\n  }\n\n  transitionEnd(e) {\n    e.target.style.height = '';\n  }\n\n  toggleClass(toggler, content, opened) {\n    if (opened) {\n      toggler.classList.add('st-accordion__icon--opened');\n      content.classList.add('st-accordion__content--visible');\n    } else {\n      toggler.classList.remove('st-accordion__icon--opened');\n      content.classList.remove('st-accordion__content--visible');\n    }\n  }\n\n  toggleText(toggler, opened) {\n    let text;\n    if (opened) {\n      text = toggler.getAttribute('data-accordion-opened-text-param');\n    } else {\n      text = toggler.getAttribute('data-accordion-closed-text-param');\n    }\n    if (text) toggler.innerHTML = text;\n  }\n\n  isOpened(toggler) {\n    return toggler.matches('.st-accordion__icon--opened');\n  }\n\n  findContent(toggler) {\n    let id = this.getID(toggler);\n    return this.scope.findElement(`[data-accordion-id=\"${id}\"]`);\n  }\n\n  getID(toggler) {\n    return toggler.getAttribute('href').replace(/^#/, '');\n  }\n}\n"],"names":["Store","constructor","controller","this","togglers","openedTogglers","key","storeKeyValue","load","ids","idSet","Set","forEach","toggler","content","findContent","has","getID","show","hide","save","map","json","sessionStorage","getItem","JSON","parse","error","console","value","setItem","stringify","_Class","Controller","context","bindingObserver","bindings","filter","binding","action","methodName","element","isOpened","contents","scope","findAllElements","connect","init","store","toggle","e","contains","target","close","open","preventDefault","dispatch","detail","transition","style","height","removeEventListener","transitionEnd","addEventListener","setTimeout","scrollHeight","toggleClass","toggleText","opened","classList","add","remove","text","getAttribute","innerHTML","matches","id","findElement","replace","values","storeKey","String"],"mappings":"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"}